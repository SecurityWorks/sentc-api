prefix: "/api"
routes:
  - group:
      p: "/v1"
      gr:
        #_______________________________________________________________________________________________________________
        # normal file handling
        - group:
            p: "/file"
            mw:
              - server_api::sentc_app_mw
            gr:
              #_________________________________________________________________________________________________________
              # routes req a jwt
              - group:
                  p: ""
                  mw:
                    - server_api::sentc_jwt_mw
                  gr:
                    - post: {p: "", s: server_api::sentc_file_controller::register_file}
                    - put: {p: "/:file_id", s: server_api::sentc_file_controller::update_file_name}
                    - delete: {p: "/:file_id", s: server_api::sentc_file_controller::delete_file}
              - get:
                  p: "/:file_id"
                  s: server_api::sentc_file_controller::get_file
                  mw:
                    - server_api::sentc_jwt_optional_mw
              - get: {p: "/:file_id/part_fetch/:last_sequence", s: server_api::sentc_file_controller::get_parts}
              #_________________________________________________________________________________________________________
              # group for file parts
              - group:
                  p: "/part"
                  gr:
                    - get: {p: "/:part_id", s: server_api::sentc_file_controller::download_part}
                    - group:
                        p: "/:session_id/:seq/:end"
                        mw:
                          - server_api::sentc_jwt_mw
                        gr:
                          # Upload to our backend
                          - post: {p: "", s: server_api::sentc_file_controller::upload_part}
                          # upload to customer backend and register the part
                          - patch: {p: "", s: server_api::sentc_file_controller::register_file_part}
        #_______________________________________________________________________________________________________________
        # handle file in group
        - group:
            p: "/group/:group_id/file"
            mw:
              - server_api::sentc_group_mw
              - server_api::sentc_jwt_mw
              - server_api::sentc_app_mw
            gr:
              - post: {p: "", s: server_api::sentc_file_controller::register_file_in_group}
              - get: {p: "/:file_id", s: server_api::sentc_file_controller::get_file_in_group}
              - delete: {p: "/:file_id", s: server_api::sentc_file_controller::delete_file_in_group}